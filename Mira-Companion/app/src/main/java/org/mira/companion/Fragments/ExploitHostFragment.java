package org.mira.companion.Fragments;


import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;
import android.widget.ToggleButton;
import android.util.Log;

import org.mira.companion.R;
import org.mira.companion.Utils.ExploitWebServer;

import butterknife.BindView;
import butterknife.ButterKnife;
import fi.iki.elonen.NanoHTTPD;

/**
 * A simple {@link Fragment} subclass.
 */
public class ExploitHostFragment extends Fragment {


    @BindView(R.id.server_status)
    TextView server_status;

    @BindView(R.id.server_ip)
    TextView server_ip;

    @BindView(R.id.server_toogle)
    ToggleButton server_toogle;


    public ExploitHostFragment() {
        // Required empty public constructor
    }

    ExploitWebServer exploitWebServer;
    boolean serverStatus = false;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View v = inflater.inflate(R.layout.fragment_exploit_host, container, false);
        ButterKnife.bind(this, v);
        ButterKnife.setDebug(true);

     //   exploitWebServer = ExploitWebServer();
       // exploitWebServer = new ExploitWebServer(9913);
        exploitWebServer = new ExploitWebServer(8080);


       try {
            exploitWebServer.start();
        }
        catch (Exception ex)
        {                   server_status.setText("Server was started at : ");
            server_ip.setText(exploitWebServer.getHostname()+":"+exploitWebServer.getListeningPort());
            Log.e("Exploit Server", "Server wasn't started -  Exception :  "+ex.getMessage());
        }



        if(exploitWebServer.isAlive())
        {
            Log.e("Exploit Server", "Server is Live"+exploitWebServer.toString());
        }

        server_toogle.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                serverStatus = !serverStatus;
                server_toogle.setChecked(serverStatus);

                if(serverStatus)
                {
                    try {
                        exploitWebServer.start();
                    }
                    catch (Exception ex)
                    {
                        Log.e("Exploit Server", "Server wasn't started -  Exception :  "+ex.getMessage());
                    }

                    if(exploitWebServer.wasStarted())
                    {
                        server_toogle.setText("Turn Off");
                        server_status.setText("Server was started at : ");
                        server_ip.setText(exploitWebServer.getHostname()+":"+exploitWebServer.getListeningPort());
                        Toast.makeText(getContext(), "Exploit Server was started...", Toast.LENGTH_SHORT).show();
                    }
                    else
                    {
                        Toast.makeText(getContext(), "Exploit Server couldn't get started. AN error occured", Toast.LENGTH_SHORT).show();
                    }
                }

                else
                {


                    try {
                        exploitWebServer.stop();
                    }
                    catch (Exception ex)
                    {
                        Log.e("Exploit Server", "Server hasn't stopped -  Exception :  "+ex.getMessage());
                    }

                    if(!exploitWebServer.wasStarted())
                    {
                        server_toogle.setText("Turn On");
                        server_status.setText("Server has been stopped ! ");
                        server_ip.setText("");
                        Toast.makeText(getContext(), "Exploit Server has stopped...", Toast.LENGTH_SHORT).show();
                    }
                    else
                    {
                        Toast.makeText(getContext(), "Exploit Server couldn't stop AN error occured", Toast.LENGTH_SHORT).show();
                    }


                }


            }
        });




        return v;
    }

}
